define("ace/ext/searchbox",["require","exports","module","ace/lib/dom","ace/lib/lang","ace/lib/event","ace/keyboard/hash_handler","ace/lib/keys"],function(e,t,i){"use strict";var c=e("../lib/dom"),n=e("../lib/lang"),a=e("../lib/event"),o=e("../keyboard/hash_handler").HashHandler,s=e("../lib/keys");c.importCssString(".ace_search {background-color: #ddd;border: 1px solid #cbcbcb;border-top: 0 none;max-width: 325px;overflow: hidden;margin: 0;padding: 4px;padding-right: 6px;padding-bottom: 0;position: absolute;top: 0px;z-index: 99;white-space: normal;}.ace_search.left {border-left: 0 none;border-radius: 0px 0px 5px 0px;left: 0;}.ace_search.right {border-radius: 0px 0px 0px 5px;border-right: 0 none;right: 0;}.ace_search_form, .ace_replace_form {border-radius: 3px;border: 1px solid #cbcbcb;float: left;margin-bottom: 4px;overflow: hidden;}.ace_search_form.ace_nomatch {outline: 1px solid red;}.ace_search_field {background-color: white;border-right: 1px solid #cbcbcb;border: 0 none;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;float: left;height: 22px;outline: 0;padding: 0 7px;width: 214px;margin: 0;}.ace_searchbtn,.ace_replacebtn {background: #fff;border: 0 none;border-left: 1px solid #dcdcdc;cursor: pointer;float: left;height: 22px;margin: 0;padding: 0;position: relative;}.ace_searchbtn:last-child,.ace_replacebtn:last-child {border-top-right-radius: 3px;border-bottom-right-radius: 3px;}.ace_searchbtn:disabled {background: none;cursor: default;}.ace_searchbtn {background-position: 50% 50%;background-repeat: no-repeat;width: 27px;}.ace_searchbtn.prev {background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADFJREFUeNpiSU1NZUAC/6E0I0yACYskCpsJiySKIiY0SUZk40FyTEgCjGgKwTRAgAEAQJUIPCE+qfkAAAAASUVORK5CYII=);    }.ace_searchbtn.next {background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADRJREFUeNpiTE1NZQCC/0DMyIAKwGJMUAYDEo3M/s+EpvM/mkKwCQxYjIeLMaELoLMBAgwAU7UJObTKsvAAAAAASUVORK5CYII=);    }.ace_searchbtn_close {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAcCAYAAABRVo5BAAAAZ0lEQVR42u2SUQrAMAhDvazn8OjZBilCkYVVxiis8H4CT0VrAJb4WHT3C5xU2a2IQZXJjiQIRMdkEoJ5Q2yMqpfDIo+XY4k6h+YXOyKqTIj5REaxloNAd0xiKmAtsTHqW8sR2W5f7gCu5nWFUpVjZwAAAABJRU5ErkJggg==) no-repeat 50% 0;border-radius: 50%;border: 0 none;color: #656565;cursor: pointer;float: right;font: 16px/16px Arial;height: 14px;margin: 5px 1px 9px 5px;padding: 0;text-align: center;width: 14px;}.ace_searchbtn_close:hover {background-color: #656565;background-position: 50% 100%;color: white;}.ace_replacebtn.prev {width: 54px}.ace_replacebtn.next {width: 27px}.ace_button {margin-left: 2px;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-o-user-select: none;-ms-user-select: none;user-select: none;overflow: hidden;opacity: 0.7;border: 1px solid rgba(100,100,100,0.23);padding: 1px;-moz-box-sizing: border-box;box-sizing:    border-box;color: black;}.ace_button:hover {background-color: #eee;opacity:1;}.ace_button:active {background-color: #ddd;}.ace_button.checked {border-color: #3399ff;opacity:1;}.ace_search_options{margin-bottom: 3px;text-align: right;-webkit-user-select: none;-moz-user-select: none;-o-user-select: none;-ms-user-select: none;user-select: none;}","ace_searchbox");function r(e,t,i){var n=c.createElement("div");n.innerHTML=l,this.element=n.firstChild,this.$init(),this.setEditor(e)}var l='<div class="ace_search right">    <button type="button" action="hide" class="ace_searchbtn_close"></button>    <div class="ace_search_form">        <input class="ace_search_field" placeholder="关键字" spellcheck="false"></input>        <button type="button" action="findNext" class="ace_searchbtn next"></button>        <button type="button" action="findPrev" class="ace_searchbtn prev"></button>        <button type="button" action="findAll" class="ace_searchbtn" title="Alt-Enter">All</button>    </div>    <div class="ace_replace_form">        <input class="ace_search_field" placeholder="Replace with" spellcheck="false"></input>        <button type="button" action="replaceAndFindNext" class="ace_replacebtn">Replace</button>        <button type="button" action="replaceAll" class="ace_replacebtn">All</button>    </div>    <div class="ace_search_options">        <span action="toggleRegexpMode" class="ace_button" title="正则匹配">.*</span>        <span action="toggleCaseSensitive" class="ace_button" title="区分大小写">Aa</span>        <span action="toggleWholeWords" class="ace_button" title="整词查找">\\b</span>    </div></div>'.replace(/>\s+/g,">");(function(){this.setEditor=function(e){e.searchBox=this,e.container.appendChild(this.element),this.editor=e},this.$initElements=function(e){this.searchBox=e.querySelector(".ace_search_form"),this.replaceBox=e.querySelector(".ace_replace_form"),this.searchOptions=e.querySelector(".ace_search_options"),this.regExpOption=e.querySelector("[action=toggleRegexpMode]"),this.caseSensitiveOption=e.querySelector("[action=toggleCaseSensitive]"),this.wholeWordOption=e.querySelector("[action=toggleWholeWords]"),this.searchInput=this.searchBox.querySelector(".ace_search_field"),this.replaceInput=this.replaceBox.querySelector(".ace_search_field")},this.$init=function(){var e=this.element;this.$initElements(e);var o=this;a.addListener(e,"mousedown",function(e){setTimeout(function(){o.activeInput.focus()},0),a.stopPropagation(e)}),a.addListener(e,"click",function(e){var t=(e.target||e.srcElement).getAttribute("action");t&&o[t]?o[t]():o.$searchBarKb.commands[t]&&o.$searchBarKb.commands[t].exec(o),a.stopPropagation(e)}),a.addCommandKeyListener(e,function(e,t,i){var n=s.keyCodeToString(i),c=o.$searchBarKb.findKeyCommand(t,n);c&&c.exec&&(c.exec(o),a.stopEvent(e))}),this.$onChange=n.delayedCall(function(){o.find(!1,!1)}),a.addListener(this.searchInput,"input",function(){o.$onChange.schedule(20)}),a.addListener(this.searchInput,"focus",function(){o.activeInput=o.searchInput,o.searchInput.value&&o.highlight()}),a.addListener(this.replaceInput,"focus",function(){o.activeInput=o.replaceInput,o.searchInput.value&&o.highlight()})},this.$closeSearchBarKb=new o([{bindKey:"Esc",name:"closeSearchBar",exec:function(e){e.searchBox.hide()}}]),this.$searchBarKb=new o,this.$searchBarKb.bindKeys({"Ctrl-f|Command-f|Ctrl-H|Command-Option-F":function(e){var t=e.isReplace=!e.isReplace;e.replaceBox.style.display=t?"":"none",e[t?"replaceInput":"searchInput"].focus()},"Ctrl-G|Command-G":function(e){e.findNext()},"Ctrl-Shift-G|Command-Shift-G":function(e){e.findPrev()},esc:function(e){setTimeout(function(){e.hide()})},Return:function(e){e.activeInput==e.replaceInput&&e.replace(),e.findNext()},"Shift-Return":function(e){e.activeInput==e.replaceInput&&e.replace(),e.findPrev()},"Alt-Return":function(e){e.activeInput==e.replaceInput&&e.replaceAll(),e.findAll()},Tab:function(e){(e.activeInput==e.replaceInput?e.searchInput:e.replaceInput).focus()}}),this.$searchBarKb.addCommands([{name:"toggleRegexpMode",bindKey:{win:"Alt-R|Alt-/",mac:"Ctrl-Alt-R|Ctrl-Alt-/"},exec:function(e){e.regExpOption.checked=!e.regExpOption.checked,e.$syncOptions()}},{name:"toggleCaseSensitive",bindKey:{win:"Alt-C|Alt-I",mac:"Ctrl-Alt-R|Ctrl-Alt-I"},exec:function(e){e.caseSensitiveOption.checked=!e.caseSensitiveOption.checked,e.$syncOptions()}},{name:"toggleWholeWords",bindKey:{win:"Alt-B|Alt-W",mac:"Ctrl-Alt-B|Ctrl-Alt-W"},exec:function(e){e.wholeWordOption.checked=!e.wholeWordOption.checked,e.$syncOptions()}}]),this.$syncOptions=function(){c.setCssClass(this.regExpOption,"checked",this.regExpOption.checked),c.setCssClass(this.wholeWordOption,"checked",this.wholeWordOption.checked),c.setCssClass(this.caseSensitiveOption,"checked",this.caseSensitiveOption.checked),this.find(!1,!1)},this.highlight=function(e){this.editor.session.highlight(e||this.editor.$search.$options.re),this.editor.renderer.updateBackMarkers()},this.find=function(e,t){var i=!this.editor.find(this.searchInput.value,{skipCurrent:e,backwards:t,wrap:!0,regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked})&&this.searchInput.value;c.setCssClass(this.searchBox,"ace_nomatch",i),this.editor._emit("findSearchBox",{match:!i}),this.highlight()},this.findNext=function(){this.find(!0,!1)},this.findPrev=function(){this.find(!0,!0)},this.findAll=function(){var e=!this.editor.findAll(this.searchInput.value,{regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked})&&this.searchInput.value;c.setCssClass(this.searchBox,"ace_nomatch",e),this.editor._emit("findSearchBox",{match:!e}),this.highlight(),this.hide()},this.replace=function(){this.editor.getReadOnly()||this.editor.replace(this.replaceInput.value)},this.replaceAndFindNext=function(){this.editor.getReadOnly()||(this.editor.replace(this.replaceInput.value),this.findNext())},this.replaceAll=function(){this.editor.getReadOnly()||this.editor.replaceAll(this.replaceInput.value)},this.hide=function(){this.element.style.display="none",this.editor.keyBinding.removeKeyboardHandler(this.$closeSearchBarKb),this.editor.focus()},this.show=function(e,t){this.element.style.display="",this.replaceBox.style.display=t?"":"none",this.isReplace=t,e&&(this.searchInput.value=e),this.searchInput.focus(),this.searchInput.select(),this.editor.keyBinding.addKeyboardHandler(this.$closeSearchBarKb)},this.isFocused=function(){var e=document.activeElement;return e==this.searchInput||e==this.replaceInput}}).call(r.prototype),t.SearchBox=r,t.Search=function(e,t){(e.searchBox||new r(e)).show(e.session.getTextRange(),t)}}),window.require(["ace/ext/searchbox"],function(){});
function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var isInitFlag=!1,initStockCodeStatus=function(){var e=$("#toggle-stockcode-link").parent("li");localStorage.getItem("isNotStockCode")?e.removeClass("checked"):e.addClass("checked")},onKeyDownNumber=function(e){this.value&&(this.value=this.value.replace(/[(A-Za-z)]/g,"").replace(/[^(\\u4e00-\\u9fa5)]/g,"").replace(/[`~!@#$^&*()=|{}':;',.<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？\[\]]/g,""))},onToggleStockCodeHelp=function(){var e=$("#toggle-stockcode-link").parent("li");localStorage.getItem("isNotStockCode")?(localStorage.removeItem("isNotStockCode"),e.addClass("checked")):(localStorage.setItem("isNotStockCode",!0),e.removeClass("checked")),handleSaveAlgorithmCode()},handleFromCode=function(e){var t=e.clone(),a=window.btoa(unescape(encodeURIComponent(t.find('[id="code"]').val())));return t.find('[id="code"]').val(a),t.append('<input type="hidden" name="encrType" id="encrType" value="base64" />'),t},handleSaveAlgorithmCode=function(){Cy.ajaxForm(handleFromCode($("form").eq(0)),"/algorithm/index/save",!1,function(e){return $("#algorithmId").val(e.data.algorithmId),setTimeout(saveDone,1e3),location.reload(),!1},null,"&algorithm[name]="+$(".algo-title").html(),function(e){BootstrapDialog.show({title:"提示",message:e.msg,onhidden:function(){saveDone()}})})},onEditKeyDown=function(){console.log("==== onEditKeyDown ===="),document.onkeydown=function(e){73===e.keyCode&&e.ctrlKey?(console.log("切换提示 ctrl + i"),onToggleStockCodeHelp(),e.preventDefault()):73===e.keyCode&&e.metaKey&&(console.log("切换提示 command + i"),onToggleStockCodeHelp(),e.preventDefault())}},handleCompileBacktest=function(e,o){return Cy.ajaxForm(handleFromCode(e),"/algorithm/index/build",!1,function(e){var t=$("#startTime").val(),a=$("#endTime").val();return $("#algorithmId").val(e.data.algorithmId),$(".build-loading").addClass("hidden"),$("#buildBtn").removeClass("hidden"),$("#log").find("pre").eq(0).html(""),$("#error-log").find("pre").eq(0).html(""),$("#daily-error-tab-link").find("i").addClass("hidden"),$("#logs-init").removeClass("hidden"),$("#daily-logs-link").click(),backtestId=e.data.backtestId,g_tradeDays=e.data.tradeDays,initChart(t,a),run(),o(e.data.backtestId_),!1},null,null,function(e){$("#daily-new-backtest-button").removeClass("hidden"),$(".build-loading").addClass("hidden"),$("#buildBtn").removeClass("hidden"),BootstrapDialog.show({title:"提示",btnOKLabel:"确认",message:"编译失败:"+e.msg}),building=0}),!1},handleBuildBacktest=function(e,a){var t=handleFromCode(e),o=localStorage.getItem("build_backtest")===Cy.getDateString()?1:0;t.append('<input type="hidden" name="useCredit" value="'+o+'"/>'),Cy.ajaxForm(t,"/algorithm/index/build",!1,function(e){a(e.data.backtestId_);var t=e.data.backtestId;return document.cookie="newBacktest="+escape(t)+";path=/",window.location.href="/algorithm/backtest/detail?backtestId="+e.data.backtestId,!1},null,null,function(e){return $("#daily-new-backtest-button").removeAttr("disabled"),e&&BootstrapDialog.show({title:"提示",btnOKLabel:"确认",message:"编译失败:"+e.msg}),disableNewBacktestBtn=!1})},parseDOM=function(){},bindListener=function(){$("body").delegate("#daily_backtest_capital_base_box","input",onKeyDownNumber)},initPlugins=function(){initStockCodeStatus(),setTimeout(function(){onEditKeyDown()},0)},init=function(){parseDOM(),bindListener(),initPlugins()};init(),window.newHuice=function(){if(!disableNewBacktestBtn){if(disableNewBacktestBtn=!0,$("#type").val(0),1==accessControl){if(!g_isWinApp||"undefined"==typeof jsObj)return void Cy.alert("无法编译，请从客户端打开");var t=editor.getValue();compileSource(t);var e=function(e){jsObj.SaveBacktestCode(e,t)}}else{$("#code").val(editor.getValue());e=function(e){}}handleBuildBacktest($("form").eq(0),e)}},updateCodeSize(),updateTabbleSize();var accessControl=$("#accessControl").val();function updateCodeSize(){var e=$("header").eq(0);if(e.hasClass("hidden"))var t=0;else t=e.height()+$("#subnav").height();var a=$("body").eq(0).height()-t-8;$("#ide-box").height(a);var o=$("#toolbar").height();$("#code-area").height(a),$("#code-area-internal").height(a-o)}function updateTabbleSize(){var e=$("#output-pane").height(),t=$("#dailybars-nav").height();if($(".dailybars-output .tabbable").hasClass("tall"))var a=0;else a=$("#dailybars-results").height()+10;var o=e-t-a-12;$("#tabbable").height(o);var n=$("#nav-tabs").height();$("#tab-content").height(o-n)}function compileSource(sourceCode){var algId=$("#algorithmId").val(),res=jsObj.compile(sourceCode),obj=eval("("+res+")");if("00000"!=obj.code)return BootstrapDialog.show({title:"提示",btnOKLabel:"确认",message:"编译失败"}),$("#error-log").find("pre").eq(0).html(obj.msg),$("#daily-error-tab-link").click(),$(".build-loading").addClass("hidden"),$("#buildBtn").removeClass("hidden"),toggleNavbar(1),building=0,!1;var filePath=obj.data,res=jsObj.UploadBinFile(algId,filePath),obj=eval("("+res+")");if(void 0===obj.data.uri)return BootstrapDialog.show({title:"提示",btnOKLabel:"确认",message:"上传文件到服务器失败:"+obj.msg}),!1;$("#code").val("#binary:"+obj.data.uri)}function build(e){if($("#type").val(e),1==accessControl){if(!g_isWinApp||"undefined"==typeof jsObj)return $(".build-loading").addClass("hidden"),$("#buildBtn").removeClass("hidden"),BootstrapDialog.show({title:"提示",btnOKLabel:"确认",message:"无法编译，请从客户端打开"}),void(building=0);var t=editor.getValue();if(0==compileSource(t))return;var a=function(e){jsObj.SaveBacktestCode(e,t)}}else{a=function(e){};$("#code").val(editor.getValue())}handleCompileBacktest($("form").eq(0),a)}$(window).resize(function(){updateCodeSize(),updateTabbleSize()}),$("body").keydown(function(e){var t=window.event||e;1==t.ctrlKey&&1==t.altKey&&66==t.keyCode&&(t.preventDefault?t.preventDefault():(t.keyCode=0,t.returnValue=!1),build(1)),1==t.ctrlKey&&1==t.altKey&&85==t.keyCode&&alert(backtestId),1==t.ctrlKey&&83==t.keyCode&&(t.preventDefault?t.preventDefault():(t.keyCode=0,t.returnValue=!1),save())}),$(window).bind("beforeunload",function(){if(1==building)return"有正在运行的回测，确定离开此页面吗？"}),$(window).bind("unload",function(){1==building&&cancel()});var toggleNavbarFlag=0;function toggleNavbar(e){e&&(toggleNavbarFlag=e),toggleNavbarFlag=0==toggleNavbarFlag?($("#dailybars-progressbar").width("0%"),$("#validate-button").attr("disabled","disabled"),$("#setting-btn-group").addClass("hidden"),$("#dailybars-status").removeClass("hidden"),1):($("#dailybars-progressbar").width("100%"),$("#validate-button").removeAttr("disabled"),$("#setting-btn-group").removeClass("hidden"),$("#dailybars-status").addClass("hidden"),$("#daily-new-backtest-button").removeClass("hidden"),0)}function cancel(){Cy.ajax("/algorithm/index/cancel",{data:"backtestId="+backtestId,async:!1,success:function(e){return stopCycle=!0,toggleNavbar(1),$("#logs-init").addClass("hidden"),building=0,!1},fail:function(e){BootstrapDialog.show({title:"提示",btnOKLabel:"确认",message:"无法取消:"+e.msg})}})}function run(){clearStats(),toggleNavbar(),initChart($("#startTime").val(),$("#endTime").val()),stopErrorLog=stopLog=stopResult=stopCycle=!1,cycleCount=0,cycleCheck()}$("#cancel-daily-backtest-button").click(function(){BootstrapDialog.confirm({title:"提示",btnCancelLabel:"取消",btnOKLabel:"确认",message:"确实要取消?",callback:function(e){e&&cancel()}})});var building=0;function getDefaultSource(e){var t="";return Cy.ajax("/algorithm/index/defaultSource",{data:"type="+e,async:!1,success:function(e){return t=e.data.code,!1},fail:function(e){}}),t}$("#validate-button").click(function(){if(1!=building){building=1;var e=$(".pyVersion").val();if("false"!==$("#pyVersionFlag").val()&&"2"===e&&!$.cookie("pyVersionTip"))return pyVersionTipDialog(function(){$(".build-loading").removeClass("hidden"),$("#buildBtn").addClass("hidden"),$("#daily-new-backtest-button").addClass("hidden"),build(1)}),!1;$(".build-loading").removeClass("hidden"),$("#buildBtn").addClass("hidden"),$("#daily-new-backtest-button").addClass("hidden"),build(1)}});var langTools=ace.require("ace/ext/language_tools");ace.require("ace/mode/pyhon"),ace.require("ace/theme/twilight");var readOnly=!0;if(1==accessControl){if(g_isWinApp&&"undefined"!=typeof jsObj){var isNew=Cy.getUrlParam("isNew"),type=Cy.getUrlParam("type");if(1==isNew&&type){var source=getDefaultSource(type);readOnly=!1}else{var algId=$("#algorithmId").attr("algorithmId_"),res=jsObj.ReadAlgCode(algId),obj=eval("("+res+")");if("00000"!=obj.code){BootstrapDialog.show({title:"提示",btnOKLabel:"确认",message:"#无法查看源码"+obj.msg});var source=""}else{var source=obj.data;readOnly=!1}}}else var source="#无法查看源码，请从客户端打开";$("#ide-container").html(source)}else $("#ide-container").html($("#code").html()),readOnly=!1;var editor=ace.edit("ide-container");$("#ide-container").removeClass("hidden"),editor.session.setMode("ace/mode/python"),editor.setTheme("ace/theme/monokai"),editor.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),readOnly&&editor.setReadOnly(!0);var jqCompleter={getCompletions:function(e,t,a,o,n){if(0===o.length)return n(null,[]);if("."==o.charAt(o.length-1)==1){var i=o.split(".");word=i[i.length-2],word=word.replace(/\(.*\)/,"()"),word=word.replace(/\[.*\]/,"[]");var r=[];if(wordList[word])for(var l=wordList[word],s=0;s<l.length;s++){if(key=l[s],key[2])var d=o+key[2];else d=o+key[0];r.push({stock:d,caption:key[0],value:o+key[0],meta:key[1]})}return n(null,r)}o=(o=(o=(o=o.replace("(","")).replace(")","")).replace("[","")).replace("]","");new RegExp(o),new RegExp(o.toUpperCase());return n(null,r=[])}};function unsave(){saving||($("#save-done-text").css("display","none"),$("#save-span").removeClass("hidden"),$("#algo-save-button").removeAttr("disabled"))}function setFontSize(e){e=e||"default",$("#ide-container").removeClass("font-small font-large font-default"),$("#ide-container").addClass("font-"+e),$("#fontsize-pref").find("li").removeClass("checked"),$('li[data-fontsize="'+e+'"]').addClass("checked")}function setTheme(e){"ambianceB"==(e=e||"ambianceB")?editor.setTheme("ace/theme/monokai"):"ambianceA"==e?editor.setTheme("ace/theme/twilight"):editor.setTheme("ace/theme/tomorrow"),$("#theme-pref").find("li").removeClass("checked"),$('li[data-theme="'+e+'"]').addClass("checked")}function setKeybind(e){"vim"==e?editor.setKeyboardHandler("ace/keyboard/vim"):"emacs"==e?editor.setKeyboardHandler("ace/keyboard/emacs"):(editor.setKeyboardHandler(null),e=null),null==e&&(e="default"),$("#keybind-pref").find("li").removeClass("checked"),$('li[data-keybind="'+e+'"]').addClass("checked")}function fullScreen(e){var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?(t.msRequestFullscreen(),enter_fullscreen(),$("#main-pane").width("100vw")):t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()}function exitFullScreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?(document.msExitFullscreen(),exit_fullscreen()):document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}langTools.addCompleter(jqCompleter),editor.on("change",function(){unsave()}),$(".algo-title").click(function(e){e.stopPropagation();var t=$(this),a=t.html();t.addClass("hidden"),$(".algo-title-box").val(a).removeClass("hidden").focus().select()}),$("#title-box").blur(function(){var e=$(this);$(this).val($(this).val().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"));var t=e.val(),a=$("#algorithmId").val();if((t=t.replace(/\s/g,""))&&!/^\S{1,100}$/.test(t))BootstrapDialog.show({title:"提示",message:"名称过长，请重新输入。",onhidden:function(){$(".algo-title-box").addClass("hidden"),$(".algo-title").removeClass("hidden")}});else{if(!t)return BootstrapDialog.show({title:"提示",message:"名称不能为空。",onhidden:function(){$(".algo-title-box").addClass("hidden"),$(".algo-title").removeClass("hidden")}}),!1;$(".algo-title-box").addClass("hidden"),$(".algo-title").html(t).removeClass("hidden"),$(document).attr("title",t),Cy.ajax("/algorithm/index/setName",{data:"algorithmId="+a+"&name="+t,success:function(e){return!1}})}}),$("#searchBtn").click(function(){editor.commands.exec("find",editor)}),$(document).attr("title",$(".algo-title").text()),editor.commands.addCommand({name:"showKeyboardShortcuts",bindKey:{win:"Ctrl-Alt-h",mac:"Command-Alt-h"},exec:function(t){ace.config.loadModule("ace/ext/keybinding_menu",function(e){e.init(t),t.showKeyboardShortcuts()})}}),editor.commands.addCommands([{name:"showSettingsMenu",bindKey:{win:"Ctrl-Alt-b",mac:"Command-Alt-b"},exec:function(e){build(1)},readOnly:!0}]),$(".dropdown-toggle").dropdown(),$(".frequency-selector-ide .dropdown-menu li").click(function(){var e=$(this).find("span").eq(0).text();$(".dropdown-menu li").removeClass("selected"),$(this).addClass("selected"),$(".filter-option").text(e),$("#frequency").val($(this).attr("rel"))}),$("#startTime,#endTime").datepicker({dateFormat:"yy-mm-dd",minDate:"2005-01-05",maxDate:"-1d",changeYear:!0,changeMonth:!0,beforeShow:function(){setTimeout(function(){$("#ui-datepicker-div").css("z-index",100007)},100)},onSelect:function(e,t){}}),$("#btnSave").click(function(){return Cy.ajaxForm($("form").eq(0),"/algorithm/code/doEdit",!1,function(e){alert("保存成功")}),!1}),$("#fontsize-pref li").bind("click",function(e){var t=$(e.currentTarget).data("fontsize");setFontSize(t),$.cookie("fontsize-pref",t,{expires:365})}),setFontSize($.cookie("fontsize-pref")),$("#theme-pref li").bind("click",function(e){var t=$(e.currentTarget).data("theme");setTheme(t),$.cookie("theme-pref",t,{expires:365})}),setTheme($.cookie("theme-pref")),$("#keybind-pref li").bind("click",function(e){var t=$(e.currentTarget).data("keybind");setKeybind(t),$.cookie("keybind-pref",t,{expires:365})}),setKeybind($.cookie("keybind-pref")),$("#code-area").resizable({autoHide:!0,handles:"e",maxWidth:$("body").width()-580,resize:function(e,t){var a=t.element.parent().width()-t.element.outerWidth(),o=t.element.next(),n=a-(o.outerWidth()-o.width())-2;o.width(n),o.css("left",t.element.width()+1),$("#splitter-bar").css("left",t.element.width()-$("#splitter-bar").width()),editor.resize()},stop:function(e,t){t.element.parent();t.element.css({width:t.element.width()}),chart&&chart.setSize($("#dailybar-chart-outer-container").width()-10)}}),tab_pane_tall=0,$("#daily-toggle-logs-button").click(function(){tab_pane_tall?shrink_log_window():expand_log_window()}),expand_log_window=function(){$tab_pane=$(".dailybars-output .tabbable"),$tab_pane.addClass("tall"),$("#daily-toggle-logs-button").removeClass("show_more"),tab_pane_tall=!0,updateTabbleSize()},shrink_log_window=function(){$tab_pane=$(".dailybars-output .tabbable"),$tab_pane.removeClass("tall"),$("#daily-toggle-logs-button").addClass("show_more"),tab_pane_tall=!1,updateTabbleSize()},$("#daily-error-tab-link").click(function(){$(this).find("i").addClass("hidden")}),document.addEventListener("fullscreenchange",function(){document.fullscreenElement?enter_fullscreen():exit_fullscreen()},!1),document.addEventListener("msfullscreenchange",function(){document.msFullscreenElement?enter_fullscreen():exit_fullscreen()},!1),document.addEventListener("mozfullscreenchange",function(){document.mozFullScreen?enter_fullscreen():exit_fullscreen()},!1),document.addEventListener("webkitfullscreenchange",function(){document.webkitIsFullScreen?enter_fullscreen():exit_fullscreen()},!1);var fullscreen=0,chart;$("#toggle-stockcode-link").click(function(){onToggleStockCodeHelp()}),$("#fullscreen-menu-link").click(function(){fullScreen(),$("#fullscreen-button").removeClass("hidden"),$(".kk_body").removeClass("top_50")}),$("#fullscreen-button").click(function(){exitFullScreen()}),enter_fullscreen=function(){fullscreen=!0,$("#subnav").addClass("hidden"),$("header").eq(0).addClass("hidden"),$(window).trigger("resize")},exit_fullscreen=function(){this.fullscreen=!1,$("#subnav").removeClass("hidden"),$("header").eq(0).removeClass("hidden"),$(window).trigger("resize"),$("#fullscreen-button").addClass("hidden"),$(".kk_body").addClass("top_50")};var resultOffset=0,userRecordOffset=0,logOffset=0,errorLogOffset=0,frequency=$("#frequency").val(),stopCycle=!1,stopResult=!1,stopLog=!1,stopErrorLog=!1,backtestId=null,dataResult=[],dataBenchmark=[],origDataOffset=0,userRecord=null,startDate=null,endDate=null;Highcharts.setOptions({global:{timezoneOffset:-480},lang:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],shortMonths:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],weekdays:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],rangeSelectorZoom:"",rangeSelectorFrom:"从",rangeSelectorTo:"到"}});var cycleCount=0;if("minute"==frequency)var timeoutSpan=2e3;else var timeoutSpan=4e3;function cycleCheck(){stopResult&&stopErrorLog&&stopLog&&(stopCycle=!0),stopCycle||(0==stopLog&&fillLog(backtestId),0==stopErrorLog&&fillErrorLog(backtestId),0==stopResult&&drawResult(backtestId),++cycleCount<=4?setTimeout(cycleCheck,500*cycleCount):setTimeout(cycleCheck,timeoutSpan))}function clearStats(){$("#total_returns").html("--"),$("#alpha").html("--"),$("#beta").html("--"),$("#sharpe").html("--"),$("#max_drawdown").html("--")}function fillStats(){Cy.ajax("/algorithm/backtest/stats?backtestId="+backtestId,{success:function(e){e.data?($("#total_returns").html((100*e.data.algorithm_return).toFixed(2)+"%"),$("#benchmark_returns").html((100*e.data.benchmark_return).toFixed(2)+"%"),$("#alpha").html(e.data.alpha.toFixed(2)),$("#beta").html(e.data.beta.toFixed(2)),$("#sharpe").html(e.data.sharpe.toFixed(2)),$("#max_drawdown").html((100*e.data.max_drawdown).toFixed(2)+"%")):setTimeout(fillStats,500)}})}function fillLog(e){Cy.ajax("/algorithm/backtest/log?backtestId="+e+"&offset="+logOffset,{fail:function(e){},success:function(e){if(0!=e.data.logArr.length||2!=e.data.state&&3!=e.data.state){if(!(e.data.offset<logOffset)){for(var t="",a=0;a<e.data.logArr.length;a++)if(e.data.logArr[a]){var o=e.data.logArr[a].split(" - ");if(2<o.length){var n='<span class="log-date">'+o[0]+"</span> - ";if("ERROR"==o[1])var i="log-error";else if("WARNING"==o[1])i="log-warning";else i="log-info";var r='<span class="'+i+'">'+o[1]+"</span> - ";o.shift(),o.shift();var l=n+r+o.join("-")}else l=e.data.logArr[a];t=t+"<p>"+l.replace(/\n/g,"<br/>"),logOffset++}0==logOffset&&0<t.length&&$("#logs-init").addClass("hidden"),$("#log").find("pre").eq(0).append(t)}}else stopLog=!0}})}function fillErrorLog(e){Cy.ajax("/algorithm/backtest/error?backtestId="+e+"&offset="+errorLogOffset,{fail:function(e){},success:function(e){if(0!=e.data.logArr.length||2!=e.data.state&&3!=e.data.state){for(var t="",a=0;a<e.data.logArr.length;a++)t=t+"<p>"+e.data.logArr[a].replace(/\n/g,"<br/>"),errorLogOffset++;$("#error-log").find("pre").eq(0).append(t),0<t.length&&!$("#daily-errors-tab").hasClass("active")&&$("#daily-error-tab-link").find("i").removeClass("hidden")}else stopErrorLog=!0}})}function clearHighchartLable(){document.domain;$("text[text-anchor=end]").each(function(){"Highcharts.com"==this.innerHTML&&$(this).remove()})}function drawResult(e){stopResult=!0,Cy.ajax("/algorithm/backtest/result?backtestId="+e+"&offset="+resultOffset+"&userRecordOffset="+userRecordOffset,{timeout:5e3,fail:function(e){stopResult=!1},error:function(e){stopResult=!1},success:function(e){if(0!=e.data.state)if(3!=e.data.state){var t=e.data.result.benchmark,a=e.data.result.overallReturn,o=e.data.result.count,n=parseInt(e.data.result.offset);if(o<=0&&2!=e.data.state)stopResult=!1;else{if(chart||(chart=newChart(e.data.userRecord),clearHighchartLable()),e.data.userRecord){if(!userRecord)for(var i in userRecord={},e.data.userRecord)userRecord[i]=getRemainNullData();for(var i in e.data.userRecord)void 0===userRecord[i]&&(userRecord[i]=getRemainNullData(),chart.addSeries({name:i,data:userRecord[i],dataGrouping:grouping_options,yAxis:1},!1))}for(u=0;u<o;u++)dataResult[u+n]&&(dataResult[u+n].x=a.time[u],dataResult[u+n].y=a.value[u],dataBenchmark[u+n].x=t.time[u],dataBenchmark[u+n].y=t.value[u]);if(e.data.userRecord){for(var i in e.data.userRecord){var r=0;for(u=0;u<e.data.userRecord[i].time.length;u++)if(e.data.userRecord[i].time[u]){var l=86400*parseInt(e.data.userRecord[i].time[u]/1e3/86400)*1e3-288e5,s=timeBar[l];void 0===userRecord[i][s]&&(userRecord[i][s]={}),userRecord[i][s].x=e.data.userRecord[i].time[u],userRecord[i][s].y=e.data.userRecord[i].value[u],r++}}userRecordOffset+=r}if(resultOffset=n+o,0<dataResult.length&&0<resultOffset&&dataResult.length>=resultOffset){var d=dataResult[resultOffset-1].x;for(u=resultOffset;u<dataResult.length&&dataResult[u].x<d;u++)dataResult[u].x=d,dataBenchmark[u].x=d}if(2==e.data.state&&(building=0)==e.data.result.count)return fillStats(),$("#logs-init").hasClass("hidden")||$("#logs-init").addClass("hidden"),toggleNavbar(1),void(initDataResult=deepCopy(dataResult));var c=Math.min(100,resultOffset/dataResult.length*100).toFixed(1);80<c&&(timeoutSpan=500),$("#dailybars-progressbar").width(c+"%"),draw(dataResult,dataBenchmark,userRecord),stopResult=!1}}else{toggleNavbar(1),building=0,$("#logs-init").addClass("hidden"),$("#daily-error-tab-link").click();var u=0,h=setInterval(function(){$("#error-log").css("display",u++%2?"none":"block"),4<u&&clearInterval(h)},150)}else stopResult=!1}})}var g_tradeDays=null,timeBar={};function getRemainNullData(){for(var e=[],t=0;t<g_tradeDays.length;t++)tick=1e3*g_tradeDays[t],e.push({x:tick,y:null}),timeBar[tick]=t;return e}function initChart(){window.startDate=startDate,window.endDate=endDate,dataResult=getRemainNullData(),dataBenchmark=getRemainNullData(),errorLogOffset=logOffset=userRecordOffset=resultOffset=origDataOffset=0,chart&&(chart.destroy(),chart=userRecord=null)}function draw(e,t,a){if(chart.series[0].setData(e,!1),chart.series[1].setData(t,!1),a){var o=2;for(var n in a)chart.series[o]&&chart.series[o].setData(a[n],!1),o++}chart.redraw()}var grouping_options=null;function newChart(e){grouping_options={enabled:!0,approximation:"average",units:[["week",[1]],["month",[1,2,3,4,6]]],groupPixelWidth:1};var t=[{type:"area",name:"策略收益",color:"#4572A7",fillOpacity:.2,tooltip:{dateTimeLabelFormats:{day:"%Y-%m-%d,%A"},valueDecimals:2,valueSuffix:"%"},data:[]},{name:"基准收益",tooltip:{dateTimeLabelFormats:{day:"%Y-%m-%d,%A"},valueDecimals:2,valueSuffix:"%"},color:"#aa4643",data:[]}];if(e){var a;for(var o in e)t.push({name:o,data:[],dataGrouping:grouping_options,yAxis:1});var n=[(a={height:"45%",lineWidth:2,title:{text:""},tickPixelInterval:20,minorGridLineWidth:1,minorTickWidth:0,opposite:!0},_defineProperty(a,"lineWidth",1),_defineProperty(a,"plotLines",[{value:0,color:"black",width:2}]),_defineProperty(a,"labels",{align:"right",x:23,formatter:function(){return this.value+"%"}}),a),_defineProperty({labels:{align:"right",x:15},title:{text:""},tickPixelInterval:20,minorGridLineWidth:1,minorTickWidth:0,opposite:!0,lineWidth:1,plotLines:[{value:0,color:"black",width:2}],top:"55%",height:"45%",offset:0},"lineWidth",2)]}else{var i;n=[(i={height:"100%",lineWidth:2,title:{text:""},tickPixelInterval:20,minorGridLineWidth:1,minorTickWidth:0,opposite:!0},_defineProperty(i,"lineWidth",1),_defineProperty(i,"plotLines",[{value:0,color:"black",width:2}]),_defineProperty(i,"labels",{align:"right",x:23,formatter:function(){return this.value+"%"}}),i)]}return chart=new Highcharts.StockChart({chart:{renderTo:"dailybar-chart-outer-container",events:{tooltipRefresh:function(e){chartHoverPointIndex=chart.hoverPoints[0].index}},animation:Highcharts.svg,marginRight:22},colors:["#89A54E","#80699B","#18a5ca","#DB843D","#A47D7C"],title:{text:""},scrollbar:{enabled:!1},rangeSelector:{enabled:!1},plotOptions:{series:{connectNulls:!0,turboThreshold:0,marker:{states:{hover:{enabled:!0,radius:4}},symbol:"circle"},animation:!1}},legend:{align:"center",verticalAlign:"top",borderWidth:0},navigator:{series:{color:"transparent",lineWidth:0},height:20,maskFill:"rgba(180, 198, 220, 0.75)",xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"}}},xAxis:{gridLineWidth:1,gridLineColor:"lightgray",categories:[],type:"datetime",tickPixelInterval:120,labels:{style:{fontSize:"10px"},formatter:function(){return Highcharts.dateFormat("%y-%m-%d",this.value)}},events:{setExtremes:function(e){isInitFlag||"rangeSelectorButton"!==e.trigger?"rangeSelectorButton"!=e.trigger&&("navigator"!==e.trigger||"mouseup"!==e.DOMEvent.type&&"touchend"!==e.DOMEvent.type)||onGetResetData(e,dataResult):isInitFlag=!0}}},yAxis:n,series:t})}var redrawChart=function(e,t,a,o){var n,i,r;n=e.filter(function(e,t){if(e.x===new Date(a).getTime())return t,e}),besicBenchmark=dataBenchmark.filter(function(e,t){if(e.x===new Date(a).getTime())return e}),t?n&&(n=n[0],i=e.map(function(e){return[e.x,e.y]}),r=dataBenchmark.map(function(e){return[e.x,e.y]})):n&&(n=n[0],i=e.map(function(e){return[e.x,(e.y-n.y)/(100+n.y)*100]}),r=dataBenchmark.map(function(e){return[e.x,(e.y-besicBenchmark[0].y)/(100+besicBenchmark[0].y)*100]})),chart.series[0].setData(i,!1),chart.series[1].setData(r,!1),chart.redraw()},onGetResetData=function(e,t){for(var a,o,n=[],i=!1,r=t,l=0;l<t.length;l++)n.push(t[l].x);a=getTick(n,e.min),o=getTick(n,e.max),a===t[0].x&&(i=!0,r=initDataResult),redrawChart(r,i,a,o)},getTick=function(i,r){var l;return i.push(r),i.sort(),i.find(function(e,t){if(e===r){if(0===t)l=i[1];else if(t===i.length-1)l=i[i.length-1];else{var a=i[t+1],o=new Date(e).getDate(),n=new Date(a).getDate();o===n?l=i[t+2]:o!==n&&(l=a)}return!0}}),l},initDataResult=[],deepCopy=function e(t){if(t instanceof Array){for(var a=[],o=0;o<t.length;++o)a[o]=e(t[o]);return a}if(t instanceof Object){a={};for(var o in t)a[o]=e(t[o]);return a}return t},chartHoverPointIndex=0;document.onkeydown=function(e){if(void 0!==chart){var t=chart,a=t.series[0].points.length;switch(e.keyCode){case 37:0==chartHoverPointIndex?chartHoverPointIndex=chartHoverPointIndex:chartHoverPointIndex-=1;for(var o=[],n=0;n<t.series.length;n++)o[n]=t.series[n].points[chartHoverPointIndex];t.tooltip.refresh(o);break;case 39:chartHoverPointIndex==a?chartHoverPointIndex=chartHoverPointIndex:chartHoverPointIndex+=1;for(o=[],n=0;n<t.series.length;n++)o[n]=t.series[n].points[chartHoverPointIndex];t.tooltip.refresh(o)}}};var saving=!1;function save(){if(!$("#save-span").hasClass("hidden")){saving=!0,$("#algo-save-button").attr("disabled","disabled"),$("#save-span").addClass("hidden"),$("#save-busy-text").css("display","block"),$("#code").val(editor.getValue());var e=$("#algorithmId").attr("algorithmId_");if(1==accessControl){if(g_isWinApp&&jsObj)jsObj.SaveAlgCode(e,$("#code").val());setTimeout(saveDone,1e3)}else{if(2==accessControl)return!1;Cy.ajaxForm(handleFromCode($("form").eq(0)),"/algorithm/index/save",!1,function(e){return $("#algorithmId").val(e.data.algorithmId),setTimeout(saveDone,1e3),!1},null,"&algorithm[name]="+$(".algo-title").html(),function(e){BootstrapDialog.show({title:"提示",message:e.msg,onhidden:function(){saveDone()}})})}}}function saveDone(){saving=!1,$("#save-busy-text").css("display","none"),$("#save-done-text").css("display","block")}function autoSave(){if(editor.getValue().length<=0)return!1;save(),setTimeout(autoSave,1e4)}$("#algo-save-button").click(function(){if(editor.getValue().length<=0)return Cy.alert("代码不能为空"),!1;save()}),setTimeout(autoSave,1e4),$("#backtest-button").click(function(){window.location.href="/algorithm/backtest/list?algorithmId="+$("#algorithmId").val()}),$("#edit-button").click(function(){window.location.href="/algorithm/backtest/buildList?algorithmId="+$("#algorithmId").val()});var disableNewBacktestBtn=!1;function showIntro(e){var t,a=function(e,t){for(var a=e.split(";"),o=0,n=a.length;o<n;o++){var i=a[o].split("=");if(t==i[0].trim())return i[1]}}(document.cookie,"isFirst"),o=new Date;o.setTime(o.getTime()+864e8),"1"!=a&&null!=a||0!=e||(document.cookie="isFirst=0;expires="+o.toGMTString(),introJs().setOptions((_defineProperty(t={skipLabel:"退出",nextLabel:"下一步",prevLabel:"上一步"},"skipLabel","跳过"),_defineProperty(t,"doneLabel","完成"),t)).start(),$.cookie("newStrategy",1,{expires:-1,path:"/"}),$.cookie("getStrategy",1,{expires:3650,path:"/"}))}$("#daily-new-backtest-button").click(function(){if("2"===$(".pyVersion").val()&&!$.cookie("pyVersionTip"))return pyVersionTipDialog(window.newHuice),!1;window.newHuice()}),$("#help-submenu").find("a").attr("target","_blank"),$(".popover-right").popover({placement:"bottom",trigger:"manual",html:!0,content:'风险指标有利于您对策略进行客观的评价，<a target="_blank" style="color:#337ab7;font-weight:normal" href="/api#%E9%A3%8E%E9%99%A9%E6%8C%87%E6%A0%87">查看计算公式</a>'}).on("mouseenter",function(){var e=this;$(this).popover("show"),$(this).siblings(".popover").on("mouseleave",function(){$(e).popover("hide")})}).on("mouseleave",function(){var e=this;setTimeout(function(){$(".popover:hover").length||$(e).popover("hide")},100)});var flag=!0;$(".flag").click(function(){flag=flag?($("#output-pane").css({display:"none"}),$("#code-area").css({width:"100.3%"}),$(this).val("<<"),$(".ui-resizable-handle").hover(function(){$(this).css({display:"none"})}),!1):($("#output-pane").css({display:"block",width:"54.9%",left:"45%"}),$("#code-area").css({width:"45%"}),$(this).val(">>"),$(".ui-resizable-handle").hover(function(){$(this).css({display:"block"})}),!0),editor.resize()}),$("#wizard-edit-button").click(function(){window.location.href="/algorithm/index/wizard?algorithmId="+$("#algorithmId").val()}),$("#hide").click(function(){var e=g_staticHost+"/algorithm/img/left1.png",t=g_staticHost+"/algorithm/img/right1.png";$(this).hasClass("no_show")?$(this).attr("src",t).removeClass("no_show"):$(this).attr("src",e).addClass("no_show")});var pyVersionTipDialog=function(e){BootstrapDialog.show({title:"提示",cssClass:"pyVersionTipDialog",message:"<p>建议使用Python3环境</p><p>Python3环境拥有更多更新的扩展库(如TensorFlow等)，并且对中文支持效果更好。</p><p>后续我们将逐步停止对 Python2 环境的迭代。</p>",buttons:[{label:"确定",cssClass:"pyVersionBtnOk",action:function(e){e.close()}},{label:'<input type="checkbox" class="checkbox-oWeek">一周内不再提醒',cssClass:"pyVersionBtnCheckbox",action:function(e,t){$(t.target).hasClass("checkbox-oWeek")||$(".checkbox-oWeek").prop("checked",function(e){return!$(this).prop("checked")})}}],onhidden:function(){$(".checkbox-oWeek").prop("checked")&&$.cookie("pyVersionTip",1,{expires:7}),e&&e()}})},newStrategyDialog=function(){var e=$.cookie("newStrategy");"false"!==$("#pyVersionFlag").val()&&e&&BootstrapDialog.show({title:"提示",cssClass:"pythonTipDialog",message:"<p>欢迎使用 Python3 运行环境，Python3 环境拥有最新版本的扩展库，后续我们将不断迭代优化。</p><p>Python3 与 Ptyhon2 在语法上有一点微小的差别，需要您注意一下，不过这对于您来说一定是非常简单的一件事情。</p><p>您还可以切换回 Python2 环境，但我们不建议您这样做，因为后续我们将逐步停止对 Python2 环境的迭代。</p>",onhidden:function(e){$.cookie("newStrategy",1,{expires:-1,path:"/"}),$.cookie("getStrategy",1,{expires:3650,path:"/"})}})};$(document).ready(function(){var e=$("#backtestId").val();document.cookie="from="+escape("edit")+";path=/",e&&$("#algo-backtest").removeClass("disabled").attr("href","/algorithm/backtest/detail?backtestId="+e),newStrategyDialog()}),$("body").delegate(".algo-title-box","blur",function(){var e=$(this);e.val()&&e.val(e.val().replace(/[`~!#$^&*()=|{}':;',.<>/?~！%#￥……&*（）——|{}【】‘；：”“'。，、？\[\]]/g,""))}),$(".pyVersion").change(function(){$(".pyVersionInput").val($(this).val())}),$("body").delegate("#algorithmCloneBtn","click",function(){var e=$(this),t=$("#algorithmId").val(),a=window.open();e.attr("disabled",!0),$.ajax({type:"POST",url:"/algorithm/index/cloneOwnAlgorithm",dataType:"JSON",data:{sourceAlgorithmId:t},success:function(e){"00000"===e.code?a.location.href="/algorithm/index/edit?algorithmId="+e.data.algorithmId:(a.close(),BootstrapDialog.alert(e.msg))},complete:function(){e.attr("disabled",!1)}})});